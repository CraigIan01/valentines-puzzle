<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>For You ðŸ’–</title>

<style>
  body {
    font-family: Arial, sans-serif;
    background: linear-gradient(135deg, #ffe6eb, #fff);
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    margin: 0;
  }

  .container {
    text-align: center;
    width: 100%;
    max-width: 420px;
    padding: 16px;
  }

  h1 {
    color: #c9184a;
    margin-bottom: 6px;
  }

  p {
    color: #555;
    margin-top: 0;
  }

  .puzzle {
    width: min(90vw, 360px);
    aspect-ratio: 1 / 1;
    margin: 20px auto;
    position: relative;
    border-radius: 12px;
    overflow: hidden;
  }

  .puzzle.hidden {
    display: none;
    pointer-events: none;
  }

  .piece {
    position: absolute;
    background-image: url('puzzle.jpg');
    background-repeat: no-repeat;
    cursor: grab;
    touch-action: none;
    user-select: none;
  }

  .hidden {
    display: none;
  }

  .button-group {
    margin-top: 20px;
  }

  button {
    padding: 14px 26px;
    font-size: 16px;
    margin: 8px;
    border: none;
    border-radius: 999px;
    cursor: pointer;
  }

  button:active {
    transform: scale(0.95);
  }

  .yes {
    background: #ff4d6d;
    color: white;
  }

  .no {
    background: #adb5bd;
    color: white;
  }

  .no.shake {
    animation: shake 0.35s;
  }

  @keyframes shake {
    0% { transform: translateX(0); }
    25% { transform: translateX(-6px); }
    50% { transform: translateX(6px); }
    75% { transform: translateX(-6px); }
    100% { transform: translateX(0); }
  }
</style>
</head>

<body>

<div class="container">
  <h1>Piece by Piece ðŸ’—</h1>
  <p id="subtitle">Put the pieces together.</p>

  <div class="puzzle" id="puzzle"></div>

  <div id="question" class="hidden">
    <h1>Will you be my Valentine? ðŸ’Œ</h1>
    <div class="button-group">
      <button class="yes" onclick="yesClicked()">Yes ðŸ’–</button>
      <button class="no" id="noBtn" onclick="noClicked()">No ðŸ™ƒ</button>
    </div>
  </div>

  <div id="final" class="hidden">
    <h1>Itâ€™s a date ðŸ’•</h1>
    <p>Happy Valentineâ€™s Day.</p>
  </div>
</div>

<script>
  const puzzle = document.getElementById('puzzle');
  const size = 4;
  let pieces = [];
  let activePiece = null;
  let offsetX = 0;
  let offsetY = 0;

  function createPuzzle() {
    puzzle.innerHTML = '';
    pieces = [];

    const puzzleSize = puzzle.clientWidth;
    const pieceSize = puzzleSize / size;

    const order = [...Array(size * size).keys()]
      .sort(() => Math.random() - 0.5);

    order.forEach((correctPos, index) => {
      const piece = document.createElement('div');
      piece.className = 'piece';
      piece.dataset.correct = correctPos;
      piece.dataset.index = index;

      piece.style.width = piece.style.height = `${pieceSize}px`;
      piece.style.left = `${(index % size) * pieceSize}px`;
      piece.style.top = `${Math.floor(index / size) * pieceSize}px`;

      piece.style.backgroundSize = `${puzzleSize}px ${puzzleSize}px`;
      piece.style.backgroundPosition =
        `-${(correctPos % size) * pieceSize}px -${Math.floor(correctPos / size) * pieceSize}px`;

      piece.addEventListener('pointerdown', onPointerDown);

      puzzle.appendChild(piece);
      pieces.push(piece);
    });
  }

  function onPointerDown(e) {
    activePiece = e.currentTarget;
    activePiece.setPointerCapture(e.pointerId);

    offsetX = e.clientX - activePiece.offsetLeft;
    offsetY = e.clientY - activePiece.offsetTop;

    activePiece.style.zIndex = 10;

    activePiece.addEventListener('pointermove', onPointerMove);
    activePiece.addEventListener('pointerup', onPointerUp);
    activePiece.addEventListener('pointercancel', onPointerUp);
  }

  function onPointerMove(e) {
    if (!activePiece) return;
    activePiece.style.left = `${e.clientX - offsetX}px`;
    activePiece.style.top = `${e.clientY - offsetY}px`;
  }

  function onPointerUp(e) {
    if (!activePiece) return;

    if (activePiece.hasPointerCapture(e.pointerId)) {
      activePiece.releasePointerCapture(e.pointerId);
    }

    const pieceSize = puzzle.clientWidth / size;
    const col = Math.round(activePiece.offsetLeft / pieceSize);
    const row = Math.round(activePiece.offsetTop / pieceSize);
    const targetIndex = row * size + col;

    const targetPiece = pieces.find(
      p => parseInt(p.dataset.index) === targetIndex
    );

    if (targetPiece && targetPiece !== activePiece) {
      swapPieces(activePiece, targetPiece, pieceSize);
    } else {
      snapBack(activePiece, pieceSize);
    }

    activePiece.style.zIndex = 1;
    activePiece.removeEventListener('pointermove', onPointerMove);
    activePiece.removeEventListener('pointerup', onPointerUp);
    activePiece.removeEventListener('pointercancel', onPointerUp);

    activePiece = null;
    checkWin();
  }

  function swapPieces(a, b, sizePx) {
    const aIndex = a.dataset.index;
    const bIndex = b.dataset.index;

    a.dataset.index = bIndex;
    b.dataset.index = aIndex;

    a.style.left = `${(bIndex % size) * sizePx}px`;
    a.style.top = `${Math.floor(bIndex / size) * sizePx}px`;

    b.style.left = `${(aIndex % size) * sizePx}px`;
    b.style.top = `${Math.floor(aIndex / size) * sizePx}px`;
  }

  function snapBack(piece, sizePx) {
    const index = piece.dataset.index;
    piece.style.left = `${(index % size) * sizePx}px`;
    piece.style.top = `${Math.floor(index / size) * sizePx}px`;
  }

  function checkWin() {
    const solved = pieces.every(
      p => p.dataset.correct === p.dataset.index
    );

    if (solved) {
      setTimeout(() => {
        puzzle.classList.add('hidden');
        document.getElementById('subtitle').classList.add('hidden');
        document.getElementById('question').classList.remove('hidden');
      }, 300);
    }
  }

  function noClicked() {
    const btn = document.getElementById('noBtn');
    btn.classList.add('shake');

    setTimeout(() => {
      btn.textContent = 'Yes ðŸ’–';
      btn.className = 'yes';
      btn.onclick = yesClicked;
    }, 350);
  }

  function yesClicked() {
    document.getElementById('question').classList.add('hidden');
    document.getElementById('final').classList.remove('hidden');
  }

  window.addEventListener('load', createPuzzle);
  window.addEventListener('resize', createPuzzle);
</script>

</body>
</html>
